{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar bytes_1 = require(\"./bytes\");\n\nvar UnicodeNormalizationForm;\n\n(function (UnicodeNormalizationForm) {\n  UnicodeNormalizationForm[\"current\"] = \"\";\n  UnicodeNormalizationForm[\"NFC\"] = \"NFC\";\n  UnicodeNormalizationForm[\"NFD\"] = \"NFD\";\n  UnicodeNormalizationForm[\"NFKC\"] = \"NFKC\";\n  UnicodeNormalizationForm[\"NFKD\"] = \"NFKD\";\n})(UnicodeNormalizationForm = exports.UnicodeNormalizationForm || (exports.UnicodeNormalizationForm = {}));\n\n; // http://stackoverflow.com/questions/18729405/how-to-convert-utf8-string-to-byte-array\n\nfunction toUtf8Bytes(str, form) {\n  if (form === void 0) {\n    form = UnicodeNormalizationForm.current;\n  }\n\n  if (form != UnicodeNormalizationForm.current) {\n    str = str.normalize(form);\n  }\n\n  var result = [];\n  var offset = 0;\n\n  for (var i = 0; i < str.length; i++) {\n    var c = str.charCodeAt(i);\n\n    if (c < 128) {\n      result[offset++] = c;\n    } else if (c < 2048) {\n      result[offset++] = c >> 6 | 192;\n      result[offset++] = c & 63 | 128;\n    } else if ((c & 0xFC00) == 0xD800 && i + 1 < str.length && (str.charCodeAt(i + 1) & 0xFC00) == 0xDC00) {\n      // Surrogate Pair\n      c = 0x10000 + ((c & 0x03FF) << 10) + (str.charCodeAt(++i) & 0x03FF);\n      result[offset++] = c >> 18 | 240;\n      result[offset++] = c >> 12 & 63 | 128;\n      result[offset++] = c >> 6 & 63 | 128;\n      result[offset++] = c & 63 | 128;\n    } else {\n      result[offset++] = c >> 12 | 224;\n      result[offset++] = c >> 6 & 63 | 128;\n      result[offset++] = c & 63 | 128;\n    }\n  }\n\n  return bytes_1.arrayify(result);\n}\n\nexports.toUtf8Bytes = toUtf8Bytes;\n; // http://stackoverflow.com/questions/13356493/decode-utf-8-with-javascript#13691499\n\nfunction toUtf8String(bytes) {\n  bytes = bytes_1.arrayify(bytes);\n  var result = '';\n  var i = 0; // Invalid bytes are ignored\n\n  while (i < bytes.length) {\n    var c = bytes[i++];\n\n    if (c >> 7 == 0) {\n      // 0xxx xxxx\n      result += String.fromCharCode(c);\n      continue;\n    } // Invalid starting byte\n\n\n    if (c >> 6 == 0x02) {\n      continue;\n    } // Multibyte; how many bytes left for thus character?\n\n\n    var extraLength = null;\n\n    if (c >> 5 == 0x06) {\n      extraLength = 1;\n    } else if (c >> 4 == 0x0e) {\n      extraLength = 2;\n    } else if (c >> 3 == 0x1e) {\n      extraLength = 3;\n    } else if (c >> 2 == 0x3e) {\n      extraLength = 4;\n    } else if (c >> 1 == 0x7e) {\n      extraLength = 5;\n    } else {\n      continue;\n    } // Do we have enough bytes in our data?\n\n\n    if (i + extraLength > bytes.length) {\n      // If there is an invalid unprocessed byte, try to continue\n      for (; i < bytes.length; i++) {\n        if (bytes[i] >> 6 != 0x02) {\n          break;\n        }\n      }\n\n      if (i != bytes.length) continue; // All leftover bytes are valid.\n\n      return result;\n    } // Remove the UTF-8 prefix from the char (res)\n\n\n    var res = c & (1 << 8 - extraLength - 1) - 1;\n    var count;\n\n    for (count = 0; count < extraLength; count++) {\n      var nextChar = bytes[i++]; // Is the char valid multibyte part?\n\n      if (nextChar >> 6 != 0x02) {\n        break;\n      }\n\n      ;\n      res = res << 6 | nextChar & 0x3f;\n    }\n\n    if (count != extraLength) {\n      i--;\n      continue;\n    }\n\n    if (res <= 0xffff) {\n      result += String.fromCharCode(res);\n      continue;\n    }\n\n    res -= 0x10000;\n    result += String.fromCharCode((res >> 10 & 0x3ff) + 0xd800, (res & 0x3ff) + 0xdc00);\n  }\n\n  return result;\n}\n\nexports.toUtf8String = toUtf8String;","map":null,"metadata":{},"sourceType":"script"}