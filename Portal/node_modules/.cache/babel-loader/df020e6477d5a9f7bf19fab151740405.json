{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('web3-utils'), require('web3-core-helpers'), require('lodash/cloneDeep'), require('@babel/runtime/helpers/get'), require('lodash/isFunction'), require('eventemitter3'), require('@babel/runtime/helpers/createClass'), require('@babel/runtime/helpers/classCallCheck'), require('@babel/runtime/helpers/possibleConstructorReturn'), require('@babel/runtime/helpers/getPrototypeOf'), require('@babel/runtime/helpers/inherits')) : typeof define === 'function' && define.amd ? define(['exports', 'web3-utils', 'web3-core-helpers', 'lodash/cloneDeep', '@babel/runtime/helpers/get', 'lodash/isFunction', 'eventemitter3', '@babel/runtime/helpers/createClass', '@babel/runtime/helpers/classCallCheck', '@babel/runtime/helpers/possibleConstructorReturn', '@babel/runtime/helpers/getPrototypeOf', '@babel/runtime/helpers/inherits'], factory) : factory(global.Web3CoreSubscriptions = {}, global.Utils, global.web3CoreHelpers, global.cloneDeep, global._get, global.isFunction, global.EventEmitter, global._createClass, global._classCallCheck, global._possibleConstructorReturn, global._getPrototypeOf, global._inherits);\n})(this, function (exports, Utils, web3CoreHelpers, cloneDeep, _get, isFunction, EventEmitter, _createClass, _classCallCheck, _possibleConstructorReturn, _getPrototypeOf, _inherits) {\n  'use strict';\n\n  cloneDeep = cloneDeep && cloneDeep.hasOwnProperty('default') ? cloneDeep['default'] : cloneDeep;\n  _get = _get && _get.hasOwnProperty('default') ? _get['default'] : _get;\n  isFunction = isFunction && isFunction.hasOwnProperty('default') ? isFunction['default'] : isFunction;\n  EventEmitter = EventEmitter && EventEmitter.hasOwnProperty('default') ? EventEmitter['default'] : EventEmitter;\n  _createClass = _createClass && _createClass.hasOwnProperty('default') ? _createClass['default'] : _createClass;\n  _classCallCheck = _classCallCheck && _classCallCheck.hasOwnProperty('default') ? _classCallCheck['default'] : _classCallCheck;\n  _possibleConstructorReturn = _possibleConstructorReturn && _possibleConstructorReturn.hasOwnProperty('default') ? _possibleConstructorReturn['default'] : _possibleConstructorReturn;\n  _getPrototypeOf = _getPrototypeOf && _getPrototypeOf.hasOwnProperty('default') ? _getPrototypeOf['default'] : _getPrototypeOf;\n  _inherits = _inherits && _inherits.hasOwnProperty('default') ? _inherits['default'] : _inherits;\n\n  var AbstractSubscription = function (_EventEmitter) {\n    _inherits(AbstractSubscription, _EventEmitter);\n\n    function AbstractSubscription(type, method, options, utils, formatters, moduleInstance) {\n      var _this;\n\n      _classCallCheck(this, AbstractSubscription);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(AbstractSubscription).call(this));\n      _this.type = type;\n      _this.method = method;\n      _this.options = options || {};\n      _this.utils = utils;\n      _this.formatters = formatters;\n      _this.moduleInstance = moduleInstance;\n      _this.id = null;\n      return _this;\n    }\n\n    _createClass(AbstractSubscription, [{\n      key: \"beforeSubscription\",\n      value: function beforeSubscription(moduleInstance) {}\n    }, {\n      key: \"onNewSubscriptionItem\",\n      value: function onNewSubscriptionItem(subscriptionItem) {\n        return subscriptionItem;\n      }\n    }, {\n      key: \"subscribe\",\n      value: function subscribe(callback) {\n        var _this2 = this;\n\n        this.beforeSubscription(this.moduleInstance);\n        this.moduleInstance.currentProvider.subscribe(this.type, this.method, [this.options]).then(function (subscriptionId) {\n          _this2.id = subscriptionId;\n\n          _this2.moduleInstance.currentProvider.on(_this2.id, function (response) {\n            var formattedOutput = _this2.onNewSubscriptionItem(response.result);\n\n            _this2.emit('data', formattedOutput);\n\n            if (isFunction(callback)) {\n              callback(false, formattedOutput);\n            }\n          });\n        }).catch(function (error) {\n          _this2.emit('error', error);\n\n          if (isFunction(callback)) {\n            callback(error, null);\n          }\n        });\n        return this;\n      }\n    }, {\n      key: \"unsubscribe\",\n      value: function unsubscribe(callback) {\n        var _this3 = this;\n\n        return this.moduleInstance.currentProvider.unsubscribe(this.id, this.type.slice(0, 3) + '_unsubscribe').then(function (response) {\n          if (!response) {\n            var error = new Error('Error on unsubscribe!');\n\n            if (isFunction(callback)) {\n              callback(error, null);\n            }\n\n            throw error;\n          }\n\n          _this3.id = null;\n\n          _this3.removeAllListeners('data');\n\n          if (isFunction(callback)) {\n            callback(false, true);\n          }\n\n          return true;\n        });\n      }\n    }]);\n\n    return AbstractSubscription;\n  }(EventEmitter);\n\n  var LogSubscription = function (_AbstractSubscription) {\n    _inherits(LogSubscription, _AbstractSubscription);\n\n    function LogSubscription(options, utils, formatters, moduleInstance, getPastLogsMethod) {\n      var _this;\n\n      _classCallCheck(this, LogSubscription);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(LogSubscription).call(this, 'eth_subscribe', 'logs', options, utils, formatters, moduleInstance));\n      _this.getPastLogsMethod = getPastLogsMethod;\n      return _this;\n    }\n\n    _createClass(LogSubscription, [{\n      key: \"subscribe\",\n      value: function subscribe(callback) {\n        var _this2 = this;\n\n        if (this.options.fromBlock && this.options.fromBlock !== 'latest' || this.options.fromBlock === 0) {\n          this.getPastLogsMethod.parameters = [this.formatters.inputLogFormatter(this.options)];\n          this.getPastLogsMethod.execute(this.moduleInstance).then(function (logs) {\n            logs.forEach(function (log) {\n              callback(false, log);\n\n              _this2.emit('data', log);\n            });\n            delete _this2.options.fromBlock;\n\n            _get(_getPrototypeOf(LogSubscription.prototype), \"subscribe\", _this2).call(_this2, callback);\n          }).catch(function (error) {\n            _this2.emit('error', error);\n\n            callback(error, null);\n          });\n          return this;\n        }\n\n        _get(_getPrototypeOf(LogSubscription.prototype), \"subscribe\", this).call(this, callback);\n\n        return this;\n      }\n    }, {\n      key: \"onNewSubscriptionItem\",\n      value: function onNewSubscriptionItem(subscriptionItem) {\n        return this.formatters.outputLogFormatter(subscriptionItem);\n      }\n    }]);\n\n    return LogSubscription;\n  }(AbstractSubscription);\n\n  var NewHeadsSubscription = function (_AbstractSubscription) {\n    _inherits(NewHeadsSubscription, _AbstractSubscription);\n\n    function NewHeadsSubscription(utils, formatters, moduleInstance) {\n      _classCallCheck(this, NewHeadsSubscription);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(NewHeadsSubscription).call(this, 'eth_subscribe', 'newHeads', null, utils, formatters, moduleInstance));\n    }\n\n    _createClass(NewHeadsSubscription, [{\n      key: \"onNewSubscriptionItem\",\n      value: function onNewSubscriptionItem(subscriptionItem) {\n        return this.formatters.outputBlockFormatter(subscriptionItem);\n      }\n    }]);\n\n    return NewHeadsSubscription;\n  }(AbstractSubscription);\n\n  var NewPendingTransactionsSubscription = function (_AbstractSubscription) {\n    _inherits(NewPendingTransactionsSubscription, _AbstractSubscription);\n\n    function NewPendingTransactionsSubscription(utils, formatters, moduleInstance) {\n      _classCallCheck(this, NewPendingTransactionsSubscription);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(NewPendingTransactionsSubscription).call(this, 'eth_subscribe', 'newPendingTransactions', null, utils, formatters, moduleInstance));\n    }\n\n    return NewPendingTransactionsSubscription;\n  }(AbstractSubscription);\n\n  var SyncingSubscription = function (_AbstractSubscription) {\n    _inherits(SyncingSubscription, _AbstractSubscription);\n\n    function SyncingSubscription(utils, formatters, moduleInstance) {\n      var _this;\n\n      _classCallCheck(this, SyncingSubscription);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(SyncingSubscription).call(this, 'eth_subscribe', 'syncing', null, utils, formatters, moduleInstance));\n      _this.isSyncing = null;\n      return _this;\n    }\n\n    _createClass(SyncingSubscription, [{\n      key: \"onNewSubscriptionItem\",\n      value: function onNewSubscriptionItem(subscriptionItem) {\n        var isSyncing = subscriptionItem.result.syncing;\n\n        if (this.isSyncing === null) {\n          this.isSyncing = isSyncing;\n          this.emit('changed', this.isSyncing);\n        }\n\n        if (this.isSyncing === true && isSyncing === false) {\n          this.isSyncing = isSyncing;\n          this.emit('changed', this.isSyncing);\n        }\n\n        if (this.isSyncing === false && isSyncing === true) {\n          this.isSyncing = isSyncing;\n          this.emit('changed', this.isSyncing);\n        }\n\n        return this.formatters.outputSyncingFormatter(subscriptionItem);\n      }\n    }]);\n\n    return SyncingSubscription;\n  }(AbstractSubscription);\n\n  var MessagesSubscription = function (_AbstractSubscription) {\n    _inherits(MessagesSubscription, _AbstractSubscription);\n\n    function MessagesSubscription(options, utils, formatters, moduleInstance) {\n      _classCallCheck(this, MessagesSubscription);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(MessagesSubscription).call(this, 'shh_subscribe', 'messages', options, utils, formatters, moduleInstance));\n    }\n\n    return MessagesSubscription;\n  }(AbstractSubscription);\n\n  var SubscriptionsFactory = function () {\n    function SubscriptionsFactory(utils, formatters) {\n      _classCallCheck(this, SubscriptionsFactory);\n\n      this.utils = utils;\n      this.formatters = formatters;\n    }\n\n    _createClass(SubscriptionsFactory, [{\n      key: \"createLogSubscription\",\n      value: function createLogSubscription(options, moduleInstance, getPastLogsMethod) {\n        return new LogSubscription(cloneDeep(options), this.utils, this.formatters, moduleInstance, getPastLogsMethod);\n      }\n    }, {\n      key: \"createNewHeadsSubscription\",\n      value: function createNewHeadsSubscription(moduleInstance) {\n        return new NewHeadsSubscription(this.utils, this.formatters, moduleInstance);\n      }\n    }, {\n      key: \"createNewPendingTransactionsSubscription\",\n      value: function createNewPendingTransactionsSubscription(moduleInstance) {\n        return new NewPendingTransactionsSubscription(this.utils, this.formatters, moduleInstance);\n      }\n    }, {\n      key: \"createSyncingSubscription\",\n      value: function createSyncingSubscription(moduleInstance) {\n        return new SyncingSubscription(this.utils, this.formatters, moduleInstance);\n      }\n    }, {\n      key: \"createShhMessagesSubscription\",\n      value: function createShhMessagesSubscription(options, moduleInstance) {\n        return new MessagesSubscription(options, this.utils, this.formatters, moduleInstance);\n      }\n    }]);\n\n    return SubscriptionsFactory;\n  }();\n\n  var SubscriptionsModuleFactory = function () {\n    function SubscriptionsModuleFactory() {\n      _classCallCheck(this, SubscriptionsModuleFactory);\n    }\n\n    _createClass(SubscriptionsModuleFactory, [{\n      key: \"createSubscriptionsFactory\",\n      value: function createSubscriptionsFactory(utils, formatters) {\n        return new SubscriptionsFactory(utils, formatters);\n      }\n    }]);\n\n    return SubscriptionsModuleFactory;\n  }();\n\n  var SubscriptionsFactory$1 = function SubscriptionsFactory() {\n    return new SubscriptionsModuleFactory().createSubscriptionsFactory(Utils, web3CoreHelpers.formatters);\n  };\n\n  exports.SubscriptionsFactory = SubscriptionsFactory$1;\n  exports.LogSubscription = LogSubscription;\n  exports.AbstractSubscription = AbstractSubscription;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":null,"metadata":{},"sourceType":"script"}